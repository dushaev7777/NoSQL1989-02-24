# Задание №13 #
1. Установить Tarantool Cartridge CLI
2. Создать шаблон приложения командой:
cartridge create --name myapp
3. Собрать и запустить приложение:
cartridge build
cartridge start
4. Задать любую топологию кластера в UI и bootstrap

# Решение #

1) Установка Tarantool Cartridge CLI будет производится на ВМ созданной в Hyper-V с параметрами:
   * Процессор — 2,1 ГГц (1 ядро)
   * Память - 4 ГБ
   * Хранилище - ssd m2 20 ГБ
   * Операционная система — CentOS 8
   * Имя хоста — Tarantool.localdomain
   * IP-адрес — 192.168.0.100

Добавим дополнительные репозитории для установки tarantool:
```
[root@Tarantool ~]# sudo dnf install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm
[root@Tarantool ~]# sudo dnf install https://mirrors.rpmfusion.org/free/el/rpmfusion-free-release-8.noarch.rpm https://mirrors.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-8.noarch.rpm
[root@Tarantool ~]# sudo dnf makecache --refresh
```
Произведем установку tarantool и cartridge-cli:
```
[root@Tarantool ~]# sudo dnf -y install tarantool
[root@Tarantool ~]# tarantoolctl rocks install cartridge-cli
[root@Tarantool ~]# export PATH=$PWD/.rocks/bin/:$PATH
```
Добавим порты:
```
[root@Tarantool ~]# sudo firewall-cmd --add-port=8081/tcp --permanent
success
[root@Tarantool ~]# sudo firewall-cmd --reload
success
```
2) Создадим шаблон приложения:
```
[root@Tarantool ~]# cartridge create --name myapp && cd myapp
cartridge create --name myapp && cd myapp
Initializing git repo in: /root/myapp
hint: Using 'master' as the name for the initial branch. This default branch name
hint: is subject to change. To configure the initial branch name to use in all
hint: of your new repositories, which will suppress this warning, call:
hint:
hint:   git config --global init.defaultBranch <name>
hint:
hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
hint: 'development'. The just-created branch can be renamed via this command:
hint:
hint:   git branch -m <name>
Initialized empty Git repository in /root/myapp/.git/
[master (root-commit) 8af32bf] Initial commit
 Committer: root <root@localhost.localdomain>
Your name and email address were configured automatically based
on your username and hostname. Please check that they are accurate.
You can suppress this message by setting them explicitly. Run the
following command and follow the instructions in your editor to edit
your configuration file:

    git config --global --edit

After doing this, you may fix the identity used for this commit with:

    git commit --amend --reset-author

 21 files changed, 334 insertions(+)
 create mode 100644 .cartridge.yml
 create mode 100644 .editorconfig
 create mode 100644 .gitignore
 create mode 100644 .luacheckrc
 create mode 100644 .luacov
 create mode 100644 Dockerfile.build.cartridge
 create mode 100644 Dockerfile.cartridge
 create mode 100644 app/roles/custom.lua
 create mode 100755 cartridge.post-build
 create mode 100755 cartridge.pre-build
 create mode 100755 deps.sh
 create mode 100755 init.lua
 create mode 100644 instances.yml
 create mode 100644 myapp-scm-1.rockspec
 create mode 100755 stateboard.init.lua
 create mode 100644 test/helper.lua
 create mode 100644 test/helper/integration.lua
 create mode 100644 test/helper/unit.lua
 create mode 100644 test/integration/api_test.lua
 create mode 100644 test/unit/sample_test.lua
 create mode 100644 tmp/.keep
Application successfully created in '/root/myapp'
[root@Tarantool myapp]# ls -l
total 36
drwxr-xr-x 3 root root   19 Apr  1 10:43 app
-rwxr-xr-x 1 root root  248 Apr  1 10:43 cartridge.post-build
-rwxr-xr-x 1 root root  247 Apr  1 10:43 cartridge.pre-build
-rwxr-xr-x 1 root root  213 Apr  1 10:43 deps.sh
-rw-r--r-- 1 root root  350 Apr  1 10:43 Dockerfile.build.cartridge
-rw-r--r-- 1 root root  410 Apr  1 10:43 Dockerfile.cartridge
-rwxr-xr-x 1 root root 1653 Apr  1 10:43 init.lua
-rw-r--r-- 1 root root  575 Apr  1 10:43 instances.yml
-rw-r--r-- 1 root root  281 Apr  1 10:43 myapp-scm-1.rockspec
-rwxr-xr-x 1 root root 1367 Apr  1 10:43 stateboard.init.lua
drwxr-xr-x 5 root root   69 Apr  1 10:43 test
drwxr-xr-x 2 root root   19 Apr  1 10:43 tmp
```
3) Собирем и запустим приложение:
```
[root@Tarantool myapp]# cartridge build
[root@Tarantool myapp]# cartridge start
```
4) Подключимся к UI для настройки кластера:

![connect](https://github.com/dushaev7777/NoSQL1989-02-24/blob/main/Image/DZ13/Tarantool_1.png)

Настроим конфигурацию серверов, будет 1 роутер для поиска бакетов и два шарда состоящие из мастера и реплики:

* Настройка роутера:

![connect](https://github.com/dushaev7777/NoSQL1989-02-24/blob/main/Image/DZ13/Tarantool_2.png)

* Настройка мастера 1ого шарда:

![connect](https://github.com/dushaev7777/NoSQL1989-02-24/blob/main/Image/DZ13/Tarantool_3.png)

* Настройка реплики 1ого шарда:

![connect](https://github.com/dushaev7777/NoSQL1989-02-24/blob/main/Image/DZ13/Tarantool_4.png)

По аналогии с конфигурацией 1ого шарда также добавим 2ой шард и произведем инициализацию кластера:

![connect](https://github.com/dushaev7777/NoSQL1989-02-24/blob/main/Image/DZ13/Tarantool_5.png)

Кластер инициализирован:

![connect](https://github.com/dushaev7777/NoSQL1989-02-24/blob/main/Image/DZ13/Tarantool_6.png)

Настройка кластера выполнена.